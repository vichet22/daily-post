<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Project Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .db-card { transition: transform 0.2s; }
        .db-card:hover { transform: translateY(-5px); }
        .query-result { max-height: 400px; overflow-y: auto; }
        .status-success { color: #28a745; }
        .status-error { color: #dc3545; }
        .post-row { cursor: pointer; }
        .post-row:hover { background-color: #f8f9fa; }
        .modal-lg { max-width: 800px; }
        .btn-group-sm .btn { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand">
                <i class="fas fa-database me-2"></i>Database Project Manager
            </span>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i>{{ session.username if session.username else 'User' }}
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/logout">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card db-card">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="fas fa-elephant me-2"></i>PostgreSQL Database</h5>
                    </div>
                    <div class="card-body">
                        <p>Daily Post Production Database</p>
                        <button type="button" class="btn btn-primary" onclick="connectDB('postgresql')">
                            <i class="fas fa-plug me-2"></i>Connect
                        </button>
                        <button type="button" class="btn btn-info" onclick="showTables('postgresql')">
                            <i class="fas fa-table me-2"></i>Tables
                        </button>
                        <button type="button" class="btn btn-success" onclick="exportData('postgresql')">
                            <i class="fas fa-download me-2"></i>Export
                        </button>
                        <button type="button" class="btn btn-warning" onclick="managePosts('postgresql')">
                            <i class="fas fa-edit me-2"></i>Manage Posts
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="manageCategories('postgresql')">
                            <i class="fas fa-tags me-2"></i>Categories
                        </button>
                        <div id="postgresql-status" class="mt-2"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card db-card">
                    <div class="card-header bg-secondary text-white">
                        <h5><i class="fas fa-database me-2"></i>SQLite Database</h5>
                    </div>
                    <div class="card-body">
                        <p>Legacy SQLite Database</p>
                        <button type="button" class="btn btn-secondary" onclick="connectDB('sqlite')">
                            <i class="fas fa-plug me-2"></i>Connect
                        </button>
                        <button type="button" class="btn btn-info" onclick="showTables('sqlite')">
                            <i class="fas fa-table me-2"></i>Tables
                        </button>
                        <button type="button" class="btn btn-success" onclick="exportData('sqlite')">
                            <i class="fas fa-download me-2"></i>Export
                        </button>
                        <button type="button" class="btn btn-warning" onclick="managePosts('sqlite')">
                            <i class="fas fa-edit me-2"></i>Manage Posts
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="manageCategories('sqlite')">
                            <i class="fas fa-tags me-2"></i>Categories
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteSQLiteDatabase()">
                            <i class="fas fa-trash me-2"></i>Delete Database
                        </button>
                        <div id="sqlite-status" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Post Management Section -->
        <div class="row mt-4 hidden" id="postManagement">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-edit me-2"></i>Post Management</h5>
                        <div>
                            <button type="button" class="btn btn-success btn-sm" onclick="showCreateModal()">
                                <i class="fas fa-plus me-2"></i>New Post
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="hidePostManagement()">
                                <i class="fas fa-times me-2"></i>Close
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="postsTable"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-terminal me-2"></i>Query Console</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <select class="form-select" id="queryDbType" title="Select Database Type" aria-label="Database Type">
                                    <option value="postgresql">PostgreSQL</option>
                                    <option value="sqlite">SQLite</option>
                                </select>
                            </div>
                            <div class="col-md-9">
                                <button type="button" class="btn btn-primary" onclick="executeQuery()">
                                    <i class="fas fa-play me-2"></i>Execute Query
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="clearQuery()">
                                    <i class="fas fa-trash me-2"></i>Clear
                                </button>
                            </div>
                        </div>
                        <textarea class="form-control mb-3" id="queryText" rows="4" 
                                  placeholder="Enter SQL query here...">SELECT * FROM post LIMIT 10;</textarea>
                        <div id="queryResult" class="query-result"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Post Modal -->
    <div class="modal fade" id="editPostModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editPostForm">
                        <input type="hidden" id="editPostId">
                        <input type="hidden" id="editDbType">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="editTitle" class="form-label">Title</label>
                                <input type="text" class="form-control" id="editTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label for="editCategory" class="form-label">Category</label>
                                <select class="form-select" id="editCategory">
                                    <option value="News">News</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Business">Business</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="General">General</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="editAuthor" class="form-label">Author</label>
                                <input type="text" class="form-control" id="editAuthor">
                            </div>
                            <div class="col-md-6">
                                <label for="editImageUrl" class="form-label">Image URL</label>
                                <input type="url" class="form-control" id="editImageUrl" placeholder="Enter image URL or upload below">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="editImageFile" class="form-label">Or Upload New Image</label>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="editImageFile" accept="image/*">
                                    <button type="button" class="btn btn-outline-secondary" onclick="uploadImage('edit')">
                                        <i class="fas fa-upload"></i> Upload
                                    </button>
                                </div>
                                <div class="form-text">Supported formats: PNG, JPG, JPEG, GIF, WEBP (Max: 16MB)</div>
                                <div id="editUploadStatus" class="mt-2"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editContent" class="form-label">Content</label>
                            <textarea class="form-control" id="editContent" rows="6" required></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFeatured">
                                <label class="form-check-label" for="editFeatured">Featured Post</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updatePost()">Update Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-tags me-2"></i>Category Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Categories</h6>
                                <div>
                                    <button type="button" class="btn btn-success btn-sm me-2" onclick="showCreateCategory()">
                                        <i class="fas fa-plus me-1"></i>Create Category
                                    </button>
                                    <span class="badge bg-info" id="categoryDbType"></span>
                                </div>
                            </div>
                            <div id="categoriesTable">
                                <div class="text-center">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Category Modal -->
    <div class="modal fade" id="createCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus me-2"></i>Create New Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createCategoryForm">
                        <input type="hidden" id="createCategoryDbType">
                        <div class="mb-3">
                            <label for="createCategoryName" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="createCategoryName" required placeholder="Enter category name">
                            <div class="form-text">A sample post will be created to establish this category.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="createCategory()">
                        <i class="fas fa-plus me-2"></i>Create Category
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div class="modal fade" id="editCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editCategoryForm">
                        <input type="hidden" id="editCategoryDbType">
                        <input type="hidden" id="editCategoryOldName">
                        <div class="mb-3">
                            <label for="editCategoryNewName" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="editCategoryNewName" required>
                            <div class="form-text">This will update all posts using this category.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateCategory()">
                        <i class="fas fa-save me-2"></i>Update Category
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Category Modal -->
    <div class="modal fade" id="deleteCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-trash me-2"></i>Delete Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="deleteCategoryDbType">
                    <input type="hidden" id="deleteCategoryName">
                    <p>What would you like to do with posts in the "<strong id="deleteCategoryDisplayName"></strong>" category?</p>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deleteAction" id="moveToGeneral" value="move_to_general" checked>
                        <label class="form-check-label" for="moveToGeneral">
                            Move posts to "General" category
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deleteAction" id="deletePosts" value="delete_posts">
                        <label class="form-check-label" for="deletePosts">
                            Delete all posts in this category
                        </label>
                    </div>
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This action cannot be undone!
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteCategory()">
                        <i class="fas fa-trash me-2"></i>Delete Category
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Post Modal -->
    <div class="modal fade" id="createPostModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createPostForm">
                        <input type="hidden" id="createDbType">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="createTitle" class="form-label">Title</label>
                                <input type="text" class="form-control" id="createTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label for="createCategory" class="form-label">Category</label>
                                <select class="form-select" id="createCategory">
                                    <option value="News">News</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Business">Business</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="General">General</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="createAuthor" class="form-label">Author</label>
                                <input type="text" class="form-control" id="createAuthor" value="Admin">
                            </div>
                            <div class="col-md-6">
                                <label for="createImageUrl" class="form-label">Image URL</label>
                                <input type="url" class="form-control" id="createImageUrl" placeholder="Enter image URL or upload below">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="createImageFile" class="form-label">Or Upload Image</label>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="createImageFile" accept="image/*">
                                    <button type="button" class="btn btn-outline-secondary" onclick="uploadImage('create')">
                                        <i class="fas fa-upload"></i> Upload
                                    </button>
                                </div>
                                <div class="form-text">Supported formats: PNG, JPG, JPEG, GIF, WEBP (Max: 16MB)</div>
                                <div id="createUploadStatus" class="mt-2"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="createContent" class="form-label">Content</label>
                            <textarea class="form-control" id="createContent" rows="6" required></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="createFeatured">
                                <label class="form-check-label" for="createFeatured">Featured Post</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="createPost()">Create Post</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function connectDB(dbType) {
            fetch(`/connect/${dbType}`)
                .then(response => response.json())
                .then(data => {
                    const statusDiv = document.getElementById(`${dbType}-status`);
                    if (data.status === 'success') {
                        statusDiv.innerHTML = `<small class="status-success"><i class="fas fa-check-circle"></i> ${data.message}</small>`;
                    } else {
                        statusDiv.innerHTML = `<small class="status-error"><i class="fas fa-times-circle"></i> ${data.message}</small>`;
                    }
                });
        }

        function executeQuery() {
            const dbType = document.getElementById('queryDbType').value;
            const query = document.getElementById('queryText').value;
            
            fetch('/query', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({db_type: dbType, query: query})
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('queryResult');
                if (data.error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else if (data.columns) {
                    let html = '<div class="table-responsive"><table class="table table-striped table-sm">';
                    html += '<thead><tr>';
                    data.columns.forEach(col => html += `<th>${col}</th>`);
                    html += '</tr></thead><tbody>';
                    data.rows.forEach(row => {
                        html += '<tr>';
                        row.forEach(cell => html += `<td>${cell || ''}</td>`);
                        html += '</tr>';
                    });
                    html += '</tbody></table></div>';
                    html += `<small class="text-muted">${data.count} rows returned</small>`;
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
                }
            });
        }

        function clearQuery() {
            document.getElementById('queryText').value = '';
            document.getElementById('queryResult').innerHTML = '';
        }

        function showTables(dbType) {
            fetch(`/tables/${dbType}`)
                .then(response => response.json())
                .then(data => {
                    console.log('Tables:', data);
                    alert(`Table information logged to console for ${dbType}`);
                });
        }

        function exportData(dbType) {
            fetch(`/export/${dbType}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(`Export failed: ${data.error}`);
                    } else {
                        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${dbType}_export_${new Date().toISOString().split('T')[0]}.json`;
                        a.click();
                    }
                });
        }

        // Post Management Functions
        let currentDbType = 'postgresql';

        function managePosts(dbType) {
            currentDbType = dbType;
            document.getElementById('postManagement').classList.remove('hidden');
            loadPosts(dbType);
        }

        function manageCategories(dbType) {
            currentDbType = dbType;
            document.getElementById('categoryDbType').textContent = dbType.toUpperCase();
            loadCategories(dbType);
            new bootstrap.Modal(document.getElementById('categoryModal')).show();
        }

        function loadCategories(dbType) {
            fetch(`/categories/${dbType}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('categoriesTable').innerHTML =
                        `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    displayCategories(data, dbType);
                }
            });
        }

        function displayCategories(data, dbType) {
            let html = '<div class="table-responsive"><table class="table table-striped table-hover">';
            html += '<thead class="table-dark"><tr>';
            html += '<th>Category</th><th>Post Count</th><th>Actions</th>';
            html += '</tr></thead><tbody>';

            data.rows.forEach(row => {
                const [category, postCount] = row;
                html += `<tr>
                    <td><span class="badge bg-secondary fs-6">${category}</span></td>
                    <td><span class="badge bg-info">${postCount} posts</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="editCategory('${category}', '${dbType}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="confirmDeleteCategory('${category}', '${dbType}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
            });

            html += '</tbody></table></div>';
            html += `<small class="text-muted">${data.rows.length} categories found</small>`;
            document.getElementById('categoriesTable').innerHTML = html;
        }

        function showCreateCategory() {
            document.getElementById('createCategoryDbType').value = currentDbType;
            document.getElementById('createCategoryName').value = '';
            new bootstrap.Modal(document.getElementById('createCategoryModal')).show();
        }

        function createCategory() {
            const categoryData = {
                db_type: document.getElementById('createCategoryDbType').value,
                category: document.getElementById('createCategoryName').value.trim()
            };

            if (!categoryData.category) {
                alert('Please enter a category name');
                return;
            }

            fetch('/create_category', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(categoryData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Create failed: ${data.error}`);
                } else {
                    alert('Category created successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('createCategoryModal')).hide();
                    loadCategories(currentDbType);
                }
            });
        }

        function editCategory(categoryName, dbType) {
            document.getElementById('editCategoryDbType').value = dbType;
            document.getElementById('editCategoryOldName').value = categoryName;
            document.getElementById('editCategoryNewName').value = categoryName;
            new bootstrap.Modal(document.getElementById('editCategoryModal')).show();
        }

        function updateCategory() {
            const categoryData = {
                db_type: document.getElementById('editCategoryDbType').value,
                old_category: document.getElementById('editCategoryOldName').value,
                new_category: document.getElementById('editCategoryNewName').value
            };

            fetch('/update_category', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(categoryData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Update failed: ${data.error}`);
                } else {
                    alert('Category updated successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('editCategoryModal')).hide();
                    loadCategories(currentDbType);
                }
            });
        }

        function confirmDeleteCategory(categoryName, dbType) {
            document.getElementById('deleteCategoryDbType').value = dbType;
            document.getElementById('deleteCategoryName').value = categoryName;
            document.getElementById('deleteCategoryDisplayName').textContent = categoryName;
            new bootstrap.Modal(document.getElementById('deleteCategoryModal')).show();
        }

        function deleteCategory() {
            const action = document.querySelector('input[name="deleteAction"]:checked').value;
            const categoryData = {
                db_type: document.getElementById('deleteCategoryDbType').value,
                category: document.getElementById('deleteCategoryName').value,
                action: action
            };

            fetch('/delete_category', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(categoryData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Delete failed: ${data.error}`);
                } else {
                    const actionText = action === 'delete_posts' ? 'deleted with all posts' : 'deleted (posts moved to General)';
                    alert(`Category ${actionText} successfully!`);
                    bootstrap.Modal.getInstance(document.getElementById('deleteCategoryModal')).hide();
                    loadCategories(currentDbType);
                }
            });
        }

        function hidePostManagement() {
            document.getElementById('postManagement').classList.add('hidden');
        }

        function loadPosts(dbType) {
            fetch(`/posts/${dbType}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('postsTable').innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                    } else {
                        displayPosts(data, dbType);
                    }
                });
        }

        function displayPosts(data, dbType) {
            let html = '<div class="table-responsive"><table class="table table-striped table-hover">';
            html += '<thead class="table-dark"><tr>';
            html += '<th>ID</th><th>Title</th><th>Author</th><th>Category</th><th>Featured</th><th>Date</th><th>Actions</th>';
            html += '</tr></thead><tbody>';

            data.rows.forEach(row => {
                const [id, title, author, category, featured, date_posted] = row;
                const featuredBadge = featured ? '<span class="badge bg-warning">Featured</span>' : '';
                const shortTitle = title.length > 40 ? title.substring(0, 40) + '...' : title;
                const formattedDate = new Date(date_posted).toLocaleDateString();

                html += `<tr class="post-row">
                    <td>${id}</td>
                    <td>${shortTitle}</td>
                    <td>${author || 'N/A'}</td>
                    <td><span class="badge bg-secondary">${category}</span></td>
                    <td>${featuredBadge}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="editPost(${id}, '${dbType}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deletePost(${id}, '${dbType}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
            });

            html += '</tbody></table></div>';
            html += `<small class="text-muted">${data.rows.length} posts found</small>`;
            document.getElementById('postsTable').innerHTML = html;
        }

        function editPost(postId, dbType) {
            fetch(`/post/${dbType}/${postId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(`Error loading post: ${data.error}`);
                    } else {
                        const post = data.rows[0];
                        document.getElementById('editPostId').value = post[0];
                        document.getElementById('editDbType').value = dbType;
                        document.getElementById('editTitle').value = post[1];
                        document.getElementById('editContent').value = post[2];
                        document.getElementById('editAuthor').value = post[3];
                        document.getElementById('editCategory').value = post[5];
                        document.getElementById('editFeatured').checked = post[6];
                        document.getElementById('editImageUrl').value = post[7] || '';
                        document.getElementById('editUploadStatus').innerHTML = '';
                        document.getElementById('editImageFile').value = '';

                        new bootstrap.Modal(document.getElementById('editPostModal')).show();
                    }
                });
        }

        function updatePost() {
            const postData = {
                db_type: document.getElementById('editDbType').value,
                id: document.getElementById('editPostId').value,
                title: document.getElementById('editTitle').value,
                content: document.getElementById('editContent').value,
                author: document.getElementById('editAuthor').value,
                category: document.getElementById('editCategory').value,
                featured: document.getElementById('editFeatured').checked,
                image_url: document.getElementById('editImageUrl').value
            };

            fetch('/update_post', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Update failed: ${data.error}`);
                } else {
                    alert('Post updated successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('editPostModal')).hide();
                    loadPosts(currentDbType);
                }
            });
        }

        function deletePost(postId, dbType) {
            if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
                fetch('/delete_post', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({db_type: dbType, id: postId})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(`Delete failed: ${data.error}`);
                    } else {
                        alert('Post deleted successfully!');
                        loadPosts(currentDbType);
                    }
                });
            }
        }

        function showCreateModal() {
            document.getElementById('createDbType').value = currentDbType;
            document.getElementById('createPostForm').reset();
            document.getElementById('createAuthor').value = 'Admin';
            document.getElementById('createUploadStatus').innerHTML = '';
            document.getElementById('createImageFile').value = '';
            new bootstrap.Modal(document.getElementById('createPostModal')).show();
        }

        function uploadImage(modalType) {
            const fileInput = document.getElementById(modalType + 'ImageFile');
            const statusDiv = document.getElementById(modalType + 'UploadStatus');
            const imageUrlInput = document.getElementById(modalType + 'ImageUrl');

            if (!fileInput.files[0]) {
                statusDiv.innerHTML = '<small class="text-danger">Please select a file first.</small>';
                return;
            }

            const formData = new FormData();
            formData.append('image_file', fileInput.files[0]);

            statusDiv.innerHTML = '<small class="text-info"><i class="fas fa-spinner fa-spin"></i> Uploading...</small>';

            fetch('/upload_image', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    statusDiv.innerHTML = `<small class="text-danger"><i class="fas fa-times"></i> ${data.error}</small>`;
                } else {
                    statusDiv.innerHTML = `<small class="text-success"><i class="fas fa-check"></i> Upload successful!</small>`;
                    imageUrlInput.value = data.image_url;
                    fileInput.value = ''; // Clear the file input
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<small class="text-danger"><i class="fas fa-times"></i> Upload failed: ${error}</small>`;
            });
        }

        function createPost() {
            const postData = {
                db_type: document.getElementById('createDbType').value,
                title: document.getElementById('createTitle').value,
                content: document.getElementById('createContent').value,
                author: document.getElementById('createAuthor').value,
                category: document.getElementById('createCategory').value,
                featured: document.getElementById('createFeatured').checked,
                image_url: document.getElementById('createImageUrl').value
            };

            fetch('/create_post', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Create failed: ${data.error}`);
                } else {
                    alert('Post created successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('createPostModal')).hide();
                    loadPosts(currentDbType);
                }
            });
        }

        function deleteSQLiteDatabase() {
            if (confirm('âš ï¸ WARNING: This will permanently delete the entire SQLite database and all its data!\n\nThis action cannot be undone. Are you absolutely sure you want to proceed?')) {
                if (confirm('ðŸ”´ FINAL CONFIRMATION: Delete the SQLite database permanently?')) {
                    fetch('/delete_database', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({db_type: 'sqlite'})
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            alert(`Delete failed: ${data.error}`);
                        } else {
                            alert('âœ… SQLite database deleted successfully!\n\nDeleted file: ' + data.deleted_file);
                            // Update the status to show database is deleted
                            document.getElementById('sqlite-status').innerHTML =
                                '<small class="status-error"><i class="fas fa-times-circle"></i> Database deleted</small>';
                        }
                    })
                    .catch(error => {
                        alert(`Delete failed: ${error}`);
                    });
                }
            }
        }
    </script>
</body>
</html>